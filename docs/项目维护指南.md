# èŠ±é¦è®¢å•ç³»ç»Ÿç»´æŠ¤æŒ‡å—

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æ›´æ–°æ—¥æœŸ**: 2025-12-13
**ç»´æŠ¤äººå‘˜**: ç³»ç»Ÿç®¡ç†å‘˜

## ğŸ“‹ ç»´æŠ¤æ¦‚è§ˆ

æœ¬æ–‡æ¡£æä¾›èŠ±é¦è®¢å•ç³»ç»Ÿçš„å®Œæ•´ç»´æŠ¤æŒ‡å—ï¼ŒåŒ…æ‹¬æ—¥å¸¸ç»´æŠ¤ã€æ•…éšœå¤„ç†ã€æ€§èƒ½ä¼˜åŒ–å’Œå®‰å…¨ç®¡ç†ã€‚

## ğŸ”§ æ—¥å¸¸ç»´æŠ¤

### æ¯æ—¥æ£€æŸ¥

#### 1. ç³»ç»ŸçŠ¶æ€æ£€æŸ¥
```bash
# æ£€æŸ¥æœåŠ¡è¿è¡ŒçŠ¶æ€
ps aux | grep -E "(node|npm)" | grep -v grep

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep -E ":(3000|5173)"

# æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h

# æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶
ls -la backend/database.db
```

#### 2. å¤‡ä»½çŠ¶æ€æ£€æŸ¥
```bash
# æ£€æŸ¥ä»Šæ—¥å¤‡ä»½æ—¥å¿—
tail -10 backups/logs/backup_$(date +%Y-%m-%d).log

# éªŒè¯GitHubå¤‡ä»½
curl -H "Authorization: token $GITHUB_TOKEN" \
     https://api.github.com/repos/grayblur/order-system-database-backups/contents/database | \
     jq -r '.[].name' | tail -1
```

#### 3. æ—¥å¿—ç›‘æ§
```bash
# æ£€æŸ¥åº”ç”¨æ—¥å¿—
tail -20 backend/logs/app.log

# æ£€æŸ¥ç³»ç»Ÿæ—¥å¿—
journalctl --since "1 hour ago" --unit systemd
```

### æ¯å‘¨ç»´æŠ¤

#### 1. æ•°æ®åº“ç»´æŠ¤
```bash
# æ•°æ®åº“å®Œæ•´æ€§æ£€æŸ¥
sqlite3 backend/database.db "PRAGMA integrity_check;"

# æ•°æ®åº“ç»Ÿè®¡ä¿¡æ¯æ›´æ–°
sqlite3 backend/database.db "ANALYZE;"

# æŸ¥çœ‹æ•°æ®åº“å¤§å°
du -h backend/database.db
```

#### 2. æ¸…ç†å·¥ä½œ
```bash
# æ¸…ç†æ—§æ—¥å¿—æ–‡ä»¶ï¼ˆä¿ç•™7å¤©ï¼‰
find backups/logs -name "*.log" -mtime +7 -delete

# æ¸…ç†ä¸´æ—¶æ–‡ä»¶
rm -rf /tmp/order-system-*

# æ¸…ç†npmç¼“å­˜ï¼ˆå¯é€‰ï¼‰
npm cache clean --force
```

#### 3. æ€§èƒ½æ£€æŸ¥
```bash
# æ£€æŸ¥å†…å­˜ä½¿ç”¨
free -h

# æ£€æŸ¥CPUä½¿ç”¨
top -bn1 | grep "Cpu(s)"

# æ£€æŸ¥è¿›ç¨‹çŠ¶æ€
ps aux --sort=-%cpu | head -10
```

### æ¯æœˆç»´æŠ¤

#### 1. ç³»ç»Ÿæ›´æ–°
```bash
# æ£€æŸ¥ç³»ç»Ÿæ›´æ–°
sudo apt update && sudo apt list --upgradable

# æ›´æ–°npmåŒ…ï¼ˆè°¨æ…æ“ä½œï¼‰
cd backend && npm outdated
cd frontend && npm outdated

# å®‰å…¨æ›´æ–°
sudo apt upgrade
```

#### 2. å¤‡ä»½éªŒè¯
```bash
# æµ‹è¯•æ¢å¤åŠŸèƒ½
bash backups/scripts/restore.sh --list

# ä¸‹è½½å¹¶éªŒè¯æœ€æ–°å¤‡ä»½
# (æ‰‹åŠ¨åœ¨GitHubä»“åº“ä¸‹è½½æœ€æ–°å¤‡ä»½æ–‡ä»¶è¿›è¡ŒéªŒè¯)
```

## ğŸš¨ æ•…éšœå¤„ç†

### æœåŠ¡æ— æ³•å¯åŠ¨

#### åç«¯æœåŠ¡é—®é¢˜
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
sudo lsof -i :3000

# æ£€æŸ¥é…ç½®æ–‡ä»¶
cat backend/package.json | grep -A 5 -B 5 "scripts"

# æ‰‹åŠ¨å¯åŠ¨æµ‹è¯•
cd backend && node stable-server.js

# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
cd backend && DEBUG=* node stable-server.js
```

#### å‰ç«¯æœåŠ¡é—®é¢˜
```bash
# æ£€æŸ¥ä¾èµ–
cd frontend && npm list --depth=0

# é‡æ–°å®‰è£…ä¾èµ–
cd frontend && rm -rf node_modules && npm install --legacy-peer-deps

# æ£€æŸ¥Viteé…ç½®
cat frontend/vite.config.js

# æ¸…ç†ç¼“å­˜å¹¶é‡å¯
cd frontend && rm -rf dist .vite && npm run dev
```

### æ•°æ®åº“é—®é¢˜

#### æ•°æ®åº“æ–‡ä»¶æŸå
```bash
# æ£€æŸ¥æ•°æ®åº“å®Œæ•´æ€§
sqlite3 backend/database.db "PRAGMA integrity_check;"

# ä»å¤‡ä»½æ¢å¤
bash backups/scripts/restore.sh --latest

# é‡ç½®æ•°æ®åº“ï¼ˆè°¨æ…æ“ä½œï¼‰
cp backend/database.db backup/database.db.backup.$(date +%Y%m%d)
sqlite3 backend/database.db "VACUUM;"
```

#### æ•°æ®åº“é”å®š
```bash
# æ£€æŸ¥é”å®šçš„è¿›ç¨‹
sudo lsof backend/database.db

# å¼ºåˆ¶è§£é”ï¼ˆè°¨æ…æ“ä½œï¼‰
sudo fuser -k backend/database.db
```

### å¤‡ä»½ç³»ç»Ÿé—®é¢˜

#### GitHubè¿æ¥å¤±è´¥
```bash
# æµ‹è¯•GitHub Token
curl -H "Authorization: token $GITHUB_TOKEN" \
     https://api.github.com/user

# æ£€æŸ¥ä»“åº“æƒé™
curl -H "Authorization: token $GITHUB_TOKEN" \
     https://api.github.com/repos/grayblur/order-system-database-backups

# æ‰‹åŠ¨æ‰§è¡Œå¤‡ä»½
bash -x backups/scripts/backup.sh
```

#### å®šæ—¶ä»»åŠ¡ä¸æ‰§è¡Œ
```bash
# æ£€æŸ¥cronæœåŠ¡
sudo systemctl status cron

# æŸ¥çœ‹å®šæ—¶ä»»åŠ¡
crontab -l

# æ£€æŸ¥cronæ—¥å¿—
sudo grep CRON /var/log/syslog | tail -10

# é‡å¯cronæœåŠ¡
sudo systemctl restart cron
```

### ç½‘ç»œé—®é¢˜

#### ç«¯å£æ— æ³•è®¿é—®
```bash
# æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€
sudo ufw status

# æ£€æŸ¥ç«¯å£ç›‘å¬
sudo netstat -tlnp | grep -E ":(3000|5173)"

# æµ‹è¯•æœ¬åœ°è¿æ¥
curl http://localhost:3000/health
curl http://localhost:5173
```

## ğŸ”’ å®‰å…¨ç®¡ç†

### æƒé™æ£€æŸ¥
```bash
# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la backend/database.db
ls -la backups/scripts/backup.sh

# ä¿®å¤æƒé™ï¼ˆå¦‚æœéœ€è¦ï¼‰
chmod 600 backend/database.db
chmod 700 backups/scripts/backup.sh
```

### å¯†é’¥ç®¡ç†
```bash
# æ£€æŸ¥GitHub Token
echo $GITHUB_TOKEN | wc -c  # åº”è¯¥æ˜¾ç¤ºé•¿åº¦ï¼ˆä¸æ˜¾ç¤ºå®é™…å†…å®¹ï¼‰

# æ›´æ–°Tokenï¼ˆå¦‚éœ€è¦ï¼‰
export GITHUB_TOKEN="new_token"
echo 'export GITHUB_TOKEN="new_token"' >> ~/.bashrc
```

### æ—¥å¿—å®¡è®¡
```bash
# æ£€æŸ¥å¼‚å¸¸ç™»å½•
sudo last | head -20

# æ£€æŸ¥ç³»ç»Ÿæ—¥å¿—å¼‚å¸¸
sudo grep -i "error\|fail\|warning" /var/log/syslog | tail -20

# æ£€æŸ¥åº”ç”¨æ—¥å¿—å¼‚å¸¸
grep -i "error\|exception" backend/logs/*.log | tail -10
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### æ•°æ®åº“ä¼˜åŒ–
```bash
# åˆ†ææŸ¥è¯¢æ€§èƒ½
sqlite3 backend/database.db "EXPLAIN QUERY PLAN SELECT * FROM orders;"

# æ¸…ç†æ•°æ®åº“ç¢ç‰‡
sqlite3 backend/database.db "VACUUM;"

# é‡å»ºç´¢å¼•
sqlite3 backend/database.db "REINDEX;"
```

### å†…å­˜ä¼˜åŒ–
```bash
# ç›‘æ§å†…å­˜ä½¿ç”¨
watch -n 5 'free -h && ps aux --sort=-%mem | head -10'

# è°ƒæ•´Node.jså†…å­˜é™åˆ¶ï¼ˆå¦‚æœéœ€è¦ï¼‰
export NODE_OPTIONS="--max-old-space-size=2048"
```

### ç½‘ç»œä¼˜åŒ–
```bash
# æ£€æŸ¥ç½‘ç»œå»¶è¿Ÿ
ping -c 4 github.com

# æ£€æŸ¥å¸¦å®½ä½¿ç”¨
iftop -i eth0
```

## ğŸ”„ å‡çº§å’Œéƒ¨ç½²

### ç³»ç»Ÿå‡çº§å‡†å¤‡
```bash
# åˆ›å»ºç³»ç»Ÿå¤‡ä»½
bash backups/scripts/backup.sh

# å¤‡ä»½é…ç½®æ–‡ä»¶
cp -r /etc/nginx/conf.d/ ./config-backup/

# è®°å½•å½“å‰ç‰ˆæœ¬
node --version > versions.txt
npm --version >> versions.txt
```

### åº”ç”¨å‡çº§æµç¨‹
```bash
# 1. åœæ­¢æœåŠ¡
pkill -f "node.*server.js"
pkill -f "npm run dev"

# 2. æ›´æ–°ä»£ç 
git pull origin main

# 3. æ›´æ–°ä¾èµ–
cd backend && npm install
cd frontend && npm install --legacy-peer-deps

# 4. æ„å»ºå‰ç«¯
cd frontend && npm run build

# 5. é‡å¯æœåŠ¡
cd backend && node stable-server.js &
cd frontend && npm run dev &

# 6. éªŒè¯æœåŠ¡
curl http://localhost:3000/health
curl http://localhost:5173
```

### å›æ»šæµç¨‹
```bash
# å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬
git checkout HEAD~1

# æ¢å¤æ•°æ®åº“ï¼ˆå¦‚éœ€è¦ï¼‰
bash backups/scripts/restore.sh --restore YYYY-MM-DD

# é‡å¯æœåŠ¡
# å‚è€ƒå‡çº§æµç¨‹çš„ç¬¬5-6æ­¥
```

## ğŸ“Š ç›‘æ§å’ŒæŠ¥å‘Š

### æ€§èƒ½ç›‘æ§
```bash
# åˆ›å»ºç›‘æ§è„šæœ¬
cat > monitor.sh << 'EOF'
#!/bin/bash
echo "=== ç³»ç»Ÿç›‘æ§æŠ¥å‘Š $(date) ==="
echo "CPUä½¿ç”¨ç‡: $(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | cut -d'%' -f1)%"
echo "å†…å­˜ä½¿ç”¨: $(free | grep Mem | awk '{printf("%.1f%%"), $3/$2 * 100.0}')"
echo "ç£ç›˜ä½¿ç”¨: $(df -h / | awk 'NR==2{print $5}')"
echo "æ•°æ®åº“å¤§å°: $(du -h backend/database.db | cut -f1)"
echo "=== æœåŠ¡çŠ¶æ€ ==="
systemctl is-active cron || echo "cronæœåŠ¡å¼‚å¸¸"
pgrep -f "node.*stable-server.js" > /dev/null && echo "åç«¯æœåŠ¡è¿è¡Œä¸­" || echo "åç«¯æœåŠ¡å¼‚å¸¸"
pgrep -f "npm run dev" > /dev/null && echo "å‰ç«¯æœåŠ¡è¿è¡Œä¸­" || echo "å‰ç«¯æœåŠ¡å¼‚å¸¸"
EOF

chmod +x monitor.sh
./monitor.sh
```

### è‡ªåŠ¨åŒ–æŠ¥å‘Š
```bash
# æ·»åŠ åˆ°cronï¼ˆæ¯å‘¨ä¸€æ—©ä¸Š9ç‚¹å‘é€æŠ¥å‘Šï¼‰
(crontab -l ; echo "0 9 * * 1 /home/zle/code/order-system/monitor.sh | mail -s 'ç³»ç»Ÿå‘¨æŠ¥' admin@example.com") | crontab -
```

## ğŸ“ ç´§æ€¥è”ç³»

### å…³é”®ä¿¡æ¯
- **GitHubä»“åº“**: https://github.com/grayblur/order-system-database-backups
- **å¤‡ä»½ä»“åº“**: https://github.com/grayblur/order-system-database-backups
- **ç³»ç»Ÿç›®å½•**: `/home/zle/code/order-system`

### ç´§æ€¥æ¢å¤æ­¥éª¤
1. ç«‹å³æ£€æŸ¥æœåŠ¡çŠ¶æ€
2. æŸ¥çœ‹æœ€æ–°é”™è¯¯æ—¥å¿—
3. å¦‚æœæ•°æ®åº“æŸåï¼Œä»GitHubæ¢å¤æœ€æ–°å¤‡ä»½
4. é‡å¯ç›¸å…³æœåŠ¡
5. éªŒè¯ç³»ç»ŸåŠŸèƒ½

---

**ç»´æŠ¤é¢‘ç‡**:
- æ¯æ—¥: ç³»ç»ŸçŠ¶æ€æ£€æŸ¥
- æ¯å‘¨: æ•°æ®åº“ç»´æŠ¤å’Œæ¸…ç†
- æ¯æœˆ: ç³»ç»Ÿæ›´æ–°å’Œå¤‡ä»½éªŒè¯
- æ¯å­£: æ€§èƒ½ä¼˜åŒ–å’Œå®¡è®¡

**æ–‡æ¡£ç»´æŠ¤**: è¯·åœ¨æ¯æ¬¡é‡å¤§å˜æ›´åæ›´æ–°æœ¬æ–‡æ¡£