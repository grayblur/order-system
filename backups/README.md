# èŠ±é¦è®¢å•ç³»ç»Ÿæ•°æ®åº“å¤‡ä»½ç³»ç»Ÿ

è¿™æ˜¯ä¸€ä¸ªå…¨è‡ªåŠ¨çš„æ•°æ®åº“å¤‡ä»½è§£å†³æ–¹æ¡ˆï¼Œç”¨äºèŠ±é¦è®¢å•ç³»ç»Ÿçš„SQLiteæ•°æ®åº“è‡ªåŠ¨å¤‡ä»½åˆ°GitHubä»“åº“ã€‚

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

- **è‡ªåŠ¨å¤‡ä»½**: æ¯å¤©å‡Œæ™¨2ç‚¹è‡ªåŠ¨å¤‡ä»½æ•°æ®åº“
- **å‹ç¼©å­˜å‚¨**: ä½¿ç”¨gzipå‹ç¼©ï¼ŒèŠ‚çœå­˜å‚¨ç©ºé—´
- **ç‰ˆæœ¬ç®¡ç†**: ä¿ç•™æœ€è¿‘30å¤©çš„å¤‡ä»½å†å²
- **å®Œæ•´æ€§éªŒè¯**: å¤‡ä»½å‰åè‡ªåŠ¨éªŒè¯æ•°æ®åº“å®Œæ•´æ€§
- **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
- **ä¸€é”®æ¢å¤**: æ”¯æŒå¿«é€Ÿæ¢å¤ä»»æ„å†å²å¤‡ä»½
- **GitHubé›†æˆ**: ä½¿ç”¨GitHubä½œä¸ºå®‰å…¨å¯é çš„å¤‡ä»½å­˜å‚¨
- **æ™ºèƒ½æ¸…ç†**: è‡ªåŠ¨æ¸…ç†è¿‡æœŸå¤‡ä»½ï¼ŒèŠ‚çœå­˜å‚¨ç©ºé—´

## ğŸ“ ç›®å½•ç»“æ„

```
backups/
â”œâ”€â”€ scripts/                # è„šæœ¬ç›®å½•
â”‚   â”œâ”€â”€ backup.sh          # è‡ªåŠ¨å¤‡ä»½è„šæœ¬
â”‚   â”œâ”€â”€ restore.sh         # æ•°æ®åº“æ¢å¤è„šæœ¬
â”‚   â”œâ”€â”€ setup.sh           # ä¸€é”®å®‰è£…è„šæœ¬
â”‚   â”œâ”€â”€ setup-crontab.md   # å®šæ—¶ä»»åŠ¡é…ç½®æŒ‡å—
â”‚   â””â”€â”€ setup-github-actions.md # GitHub Actionsé…ç½®
â”œâ”€â”€ logs/                  # æ—¥å¿—ç›®å½•
â”œâ”€â”€ temp/                  # ä¸´æ—¶æ–‡ä»¶ç›®å½•
â””â”€â”€ README.md              # æœ¬æ–‡æ¡£
```

## ğŸ› ï¸ å¿«é€Ÿå¼€å§‹

### æ–¹æ³•ä¸€ï¼šä¸€é”®å®‰è£…ï¼ˆæ¨èï¼‰

```bash
# è¿è¡Œä¸€é”®å®‰è£…è„šæœ¬
./backups/scripts/setup.sh
```

å®‰è£…è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
- æ£€æŸ¥ç³»ç»Ÿä¾èµ–
- é…ç½®GitHub Token
- è®¾ç½®å®šæ—¶ä»»åŠ¡
- æµ‹è¯•å¤‡ä»½åŠŸèƒ½
- æ˜¾ç¤ºé…ç½®ä¿¡æ¯

### æ–¹æ³•äºŒï¼šæ‰‹åŠ¨å®‰è£…

#### 1. é…ç½®GitHub Token

```bash
# åˆ›å»ºGitHub Personal Access Tokenï¼ˆéœ€è¦repoæƒé™ï¼‰
export GITHUB_TOKEN="your_personal_access_token"

# æ°¸ä¹…è®¾ç½®
echo 'export GITHUB_TOKEN="your_personal_access_token"' >> ~/.bashrc
source ~/.bashrc
```

#### 2. è®¾ç½®å®šæ—¶ä»»åŠ¡

```bash
# ç¼–è¾‘å®šæ—¶ä»»åŠ¡
crontab -e
```

æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š
```bash
# èŠ±é¦è®¢å•ç³»ç»Ÿæ•°æ®åº“è‡ªåŠ¨å¤‡ä»½
# æ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œå¤‡ä»½
0 2 * * * /home/zle/code/order-system/backups/scripts/backup.sh

# æ¯å‘¨æ—¥å‡Œæ™¨3ç‚¹æ¸…ç†è¿‡æœŸæ—¥å¿—
0 3 * * 0 find /home/zle/code/order-system/backups/logs -name "*.log" -mtime +7 -delete
```

#### 3. æµ‹è¯•å¤‡ä»½

```bash
# æ‰‹åŠ¨æ‰§è¡Œå¤‡ä»½æµ‹è¯•
./backups/scripts/backup.sh

# æŸ¥çœ‹å¤‡ä»½æ—¥å¿—
cat backups/logs/backup_$(date +%Y-%m-%d).log
```

## ğŸ“‹ ä½¿ç”¨è¯´æ˜

### å¤‡ä»½æ•°æ®åº“

#### è‡ªåŠ¨å¤‡ä»½
ç³»ç»Ÿä¼šåœ¨æ¯å¤©å‡Œæ™¨2ç‚¹è‡ªåŠ¨æ‰§è¡Œå¤‡ä»½ï¼Œæ— éœ€æ‰‹åŠ¨å¹²é¢„ã€‚

#### æ‰‹åŠ¨å¤‡ä»½
```bash
# ç«‹å³æ‰§è¡Œå¤‡ä»½
./backups/scripts/backup.sh
```

### æ¢å¤æ•°æ®åº“

#### æŸ¥çœ‹å¯ç”¨å¤‡ä»½
```bash
# åˆ—å‡ºæ‰€æœ‰å¤‡ä»½æ–‡ä»¶
./backups/scripts/restore.sh --list
```

#### æ¢å¤æœ€æ–°å¤‡ä»½
```bash
# æ¢å¤æœ€æ–°çš„å¤‡ä»½æ–‡ä»¶
./backups/scripts/restore.sh --latest
```

#### æ¢å¤æŒ‡å®šæ—¥æœŸçš„å¤‡ä»½
```bash
# æ¢å¤æŒ‡å®šæ—¥æœŸçš„å¤‡ä»½
./backups/scripts/restore.sh --restore 2025-12-12
```

#### æ¢å¤æŒ‡å®šå¤‡ä»½æ–‡ä»¶
```bash
# æ¢å¤æŒ‡å®šçš„å¤‡ä»½æ–‡ä»¶
./backups/scripts/restore.sh --backup 2025-12-12_10-30-00_database.db.gz
```

## ğŸ“Š ç›‘æ§å’Œç»´æŠ¤

### æŸ¥çœ‹æ—¥å¿—

```bash
# æŸ¥çœ‹ä»Šå¤©çš„å¤‡ä»½æ—¥å¿—
cat backups/logs/backup_$(date +%Y-%m-%d).log

# æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—æ–‡ä»¶
ls -la backups/logs/

# å®æ—¶ç›‘æ§æ—¥å¿—
tail -f backups/logs/backup_$(date +%Y-%m-%d).log
```

### æ£€æŸ¥å®šæ—¶ä»»åŠ¡

```bash
# æŸ¥çœ‹å½“å‰å®šæ—¶ä»»åŠ¡
crontab -l

# æ£€æŸ¥cronæœåŠ¡çŠ¶æ€
sudo systemctl status cron
```

### å¤‡ä»½ä»“åº“

- **å¤‡ä»½ä»“åº“åœ°å€**: https://github.com/grayblur/order-system-database-backups
- **å¤‡ä»½æ–‡ä»¶è·¯å¾„**: `database/` ç›®å½•
- **è‡ªåŠ¨æ¸…ç†**: ä¿ç•™æœ€è¿‘30å¤©çš„å¤‡ä»½

## ğŸ”§ é…ç½®é€‰é¡¹

### å¤‡ä»½è„šæœ¬é…ç½®

åœ¨ `backup.sh` ä¸­å¯ä»¥ä¿®æ”¹ä»¥ä¸‹é…ç½®ï¼š

```bash
# å¤‡ä»½ä¿ç•™å¤©æ•°
BACKUP_RETENTION_DAYS=30

# æœ€å¤§å¤‡ä»½æ–‡ä»¶å¤§å°ï¼ˆMBï¼‰
MAX_BACKUP_SIZE_MB=50

# æ˜¯å¦å¯ç”¨å‹ç¼©
COMPRESS=true

# æ˜¯å¦éªŒè¯å¤‡ä»½æ–‡ä»¶
VERIFY_BACKUP=true
```

### æ•°æ®åº“è·¯å¾„

```bash
# æ•°æ®åº“æ–‡ä»¶è·¯å¾„
DB_PATH="/home/zle/code/order-system/backend/database.db"
```

## ğŸš¨ æ³¨æ„äº‹é¡¹

### å¤‡ä»½å‰
1. ç¡®ä¿æ•°æ®åº“æ–‡ä»¶è·¯å¾„æ­£ç¡®
2. ç¡®ä¿æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´
3. ç¡®ä¿ç½‘ç»œè¿æ¥æ­£å¸¸
4. ç¡®ä¿GitHub Tokenæœ‰æ•ˆ

### æ¢å¤å‰
1. **é‡è¦**ï¼šå…ˆåœæ­¢åº”ç”¨ç¨‹åºæœåŠ¡
2. ç¡®è®¤è¦æ¢å¤çš„å¤‡ä»½æ–‡ä»¶
3. å¤‡ä»½å½“å‰æ•°æ®åº“ï¼ˆè„šæœ¬ä¼šè‡ªåŠ¨å¤‡ä»½ï¼‰
4. æ¢å¤å®Œæˆåé‡å¯åº”ç”¨ç¨‹åº

### å®‰å…¨å»ºè®®
1. å®šæœŸæ£€æŸ¥GitHub Tokenæœ‰æ•ˆæ€§
2. å®šæœŸæŸ¥çœ‹å¤‡ä»½æ—¥å¿—
3. é‡è¦æ“ä½œå‰æ‰‹åŠ¨å¤‡ä»½
4. å¤‡ä»½ä»“åº“è®¾ç½®ä¸ºç§æœ‰
5. å®šæœŸæµ‹è¯•æ¢å¤åŠŸèƒ½

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. å¤‡ä»½å¤±è´¥
```bash
# æ£€æŸ¥è„šæœ¬æƒé™
ls -la backups/scripts/backup.sh

# æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶
ls -la backend/database.db

# æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—
cat backups/logs/backup_$(date +%Y-%m-%d).log
```

#### 2. GitHubè¿æ¥å¤±è´¥
```bash
# æµ‹è¯•GitHubè¿æ¥
curl -H "Authorization: token $GITHUB_TOKEN" https://api.github.com/user

# æ£€æŸ¥Tokenæƒé™
# ç¡®ä¿Tokenå…·æœ‰repoæƒé™
```

#### 3. å®šæ—¶ä»»åŠ¡ä¸æ‰§è¡Œ
```bash
# æ£€æŸ¥cronæœåŠ¡
sudo systemctl status cron

# å¯åŠ¨cronæœåŠ¡
sudo systemctl start cron

# æŸ¥çœ‹cronæ—¥å¿—
sudo grep CRON /var/log/syslog
```

#### 4. æ¢å¤å¤±è´¥
```bash
# ç¡®ä¿åº”ç”¨ç¨‹åºå·²åœæ­¢
# æ£€æŸ¥å¤‡ä»½æ–‡ä»¶å®Œæ•´æ€§
gunzip -t backup_file.gz

# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la backend/database.db
```

### è°ƒè¯•æ¨¡å¼

```bash
# å¯ç”¨è¯¦ç»†æ—¥å¿—
set -x  # åœ¨è„šæœ¬å¼€å¤´æ·»åŠ 

# æ‰‹åŠ¨æ‰§è¡Œè°ƒè¯•
./backups/scripts/backup.sh -x
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### å¤‡ä»½ä¼˜åŒ–
- ä½¿ç”¨å‹ç¼©å‡å°‘ç½‘ç»œä¼ è¾“æ—¶é—´
- æœ¬åœ°å®Œæ•´æ€§æ£€æŸ¥é¿å…ä¼ è¾“é”™è¯¯æ–‡ä»¶
- æ™ºèƒ½ç¼“å­˜å‡å°‘é‡å¤æ“ä½œ

### å­˜å‚¨ä¼˜åŒ–
- è‡ªåŠ¨æ¸…ç†è¿‡æœŸå¤‡ä»½
- å‹ç¼©å­˜å‚¨èŠ‚çœç©ºé—´
- å¢é‡å¤‡ä»½ï¼ˆæœªæ¥ç‰ˆæœ¬ï¼‰

## ğŸ”„ ç‰ˆæœ¬å†å²

- **v1.0.0** (2025-12-12)
  - åŸºç¡€å¤‡ä»½åŠŸèƒ½
  - è‡ªåŠ¨å®šæ—¶ä»»åŠ¡
  - GitHubé›†æˆ
  - æ•°æ®åº“æ¢å¤åŠŸèƒ½
  - å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—

## ğŸ“ æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š

1. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ç¡®å®šé”™è¯¯åŸå› 
2. æ£€æŸ¥æœ¬æ–‡æ¡£çš„æ•…éšœæ’é™¤éƒ¨åˆ†
3. ç¡®è®¤æ‰€æœ‰ä¾èµ–é¡¹éƒ½æ­£ç¡®å®‰è£…
4. éªŒè¯GitHub Tokenå’Œç½‘ç»œè¿æ¥

## ğŸ“„ è®¸å¯è¯

æœ¬å¤‡ä»½ç³»ç»Ÿéµå¾ªä¸ä¸»é¡¹ç›®ç›¸åŒçš„è®¸å¯è¯ã€‚